# 基于TCP的聊天室

# 功能
把用户发送的文本消息广播给聊天室内的其他用户

# 实现
服务端程序中共四种goroutine
- main goroutine
- broadcaster goroutine
- connection read goroutine
- connection write goroutine

## broadcaster goroutine
用于记录聊天室用户，并进行消息广播
1. 新用户进来
   - 新用户进来时，先生成一个Use实例，代表该用户
   - 接着新开一个goroutine，用于给用户发送消息。
     - 需要给某个用户发送消息时，只需要在该用户的MessageChannel中写入消息即可
     - 需要注意不关闭ch导致的goroutine泄漏问题
   - 然后给当前用户发送欢迎消息，同时给聊天室所有用户发送有新用户到来的提醒
   - 接着将该用户写入全局用户列表，即聊天室用户列表
     - 通过channel写入，可避免使用锁
2. 用户普通消息
   - 循环读取用户的输入，并将用户信息发送给其他用户
3. 用户离开
   - 用户离开，需要做登记，并向其他用户发送通知

## User结构
```go
type User struct {
	ID             int         // unique user identification,generated by GenUserID
	Addr           string      // IP and port of users
	EnterAt        time.Time   // the time when an user enter the chatting
	MessageChannel chan string // used for sending messages
}
```
